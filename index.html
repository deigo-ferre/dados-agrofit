<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agrofit 2.0 - Final</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f6; padding: 20px; color: #333; }
        .container { max-width: 1250px; margin: 0 auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h1 { color: #16a085; text-align: center; }
        .search-box { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 20px; }
        .search-box:focus { border-color: #16a085; outline: none; }
        
        /* Tabela */
        table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
        th { background: #27ae60; color: white; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; word-wrap: break-word; }
        
        .marca { color: #2c3e50; font-size: 1.1em; font-weight: bold; }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; margin: 1px; }
        .bg-red { background: #e74c3c; } 
        .bg-blue { background: #3498db; }
        .bg-orange { background: #f39c12; }
        
        /* Bot√£o Bula Google */
        .btn-google {
            display: inline-block; background-color: #f1c40f; color: #333; 
            padding: 4px 8px; border-radius: 4px; text-decoration: none; 
            font-weight: bold; font-size: 11px; margin-top: 5px; border: 1px solid #e1b700;
        }
        .btn-google:hover { background-color: #f39c12; color: white; }

        .scroll-list { max-height: 100px; overflow-y: auto; background: #f9f9f9; padding: 5px; border: 1px solid #eee; }
        .item-row { border-bottom: 1px dashed #e0e0e0; padding: 2px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>üå± Agrofit 2.0 <small>Final</small></h1>
    <div id="stats" style="text-align:center; color:#666; margin-bottom:15px;">Carregando sistema...</div>

    <input type="text" id="busca" class="search-box" placeholder="üîé Digite para buscar (Ex: glifosato, soja, lagarta)...">

    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th width="20%">Produto</th>
                    <th width="20%">Detalhes</th>
                    <th width="15%">Info</th>
                    <th width="20%">Culturas</th>
                    <th width="25%">Pragas</th>
                </tr>
            </thead>
            <tbody id="resultado"></tbody>
        </table>
    </div>
</div>

<script>
    // ======================================================================
    // üëáüëáüëá IMPORTANTE: COLE O LINK DO SEU GITHUB RAW ABAIXO üëáüëáüëá
    // Exemplo: 'https://raw.githubusercontent.com/SEU-USUARIO/dados-agrofit/main/dados.json'
    const URL_DO_ARQUIVO = 'https://raw.githubusercontent.com/deigo-ferre/dados-agrofit/refs/heads/main/banco_dados_agrofit.txt';
    // ======================================================================

    let db = []; 

    // Carrega JSON com verifica√ß√£o de seguran√ßa
    fetch(URL_DO_ARQUIVO)
        .then(res => {
            if (!res.ok) throw new Error("Erro de conex√£o com o GitHub");
            return res.json();
        })
        .then(data => {
            if (Array.isArray(data)) {
                db = data;
            } else if (data.dados && Array.isArray(data.dados)) {
                db = data.dados;
            } else {
                console.error("Formato desconhecido", data);
                document.getElementById('stats').innerText = "Erro: Formato de dados inv√°lido.";
                return;
            }
            
            document.getElementById('stats').innerText = `${db.length} produtos carregados.`;
            renderizar(db.slice(0, 50));
        })
        .catch(err => {
            console.error(err);
            document.getElementById('stats').innerHTML = `<span style="color:red">ERRO: N√£o consegui ler o arquivo JSON.<br>Verifique se voc√™ colou o link RAW correto no c√≥digo.</span>`;
        });

    // Busca
    document.getElementById('busca').addEventListener('keyup', (e) => {
        const termo = e.target.value.toLowerCase();
        
        if (!Array.isArray(db)) return;

        const filtrados = db.filter(p => {
            if (p.texto_busca && p.texto_busca.includes(termo)) return true;
            return false;
        });

        document.getElementById('stats').innerText = `Encontrados: ${filtrados.length}`;
        renderizar(filtrados.slice(0, 100));
    });

    function renderizar(lista) {
        const tbody = document.getElementById('resultado');
        tbody.innerHTML = '';

        if (!lista || lista.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Nenhum produto encontrado.</td></tr>';
            return;
        }

        lista.forEach(p => {
            let tox = p.toxicol ? `<span class="badge bg-red" title="Toxicol√≥gica">‚ò†Ô∏è ${p.toxicol}</span>` : '';
            let amb = p.ambiental ? `<span class="badge bg-blue" title="Ambiental">üåç ${p.ambiental}</span>` : '';
            let acao = p.modo_acao ? `<span class="badge bg-orange">${p.modo_acao}</span>` : '';

            // Bot√£o de Bula (Recriado)
            let termoBusca = `Bula PDF ${p.marca} ${p.titular}`;
            let linkGoogle = `https://www.google.com/search?q=${encodeURIComponent(termoBusca)}`;
            let btnBula = `<a href="${linkGoogle}" target="_blank" class="btn-google">üîç Buscar Bula</a>`;

            let culturas = p.culturas.map(c => `<span class="badge" style="background:#ddd; color:#333;">${c}</span>`).join(" ");
            let pragas = p.pragas.map(pr => `<div class="item-row">üï∑Ô∏è ${pr}</div>`).join("");

            const tr = `
                <tr>
                    <td>
                        <div class="marca">${p.marca}</div>
                        <small>Reg: ${p.registro}</small><br>
                        <small style="color:#2980b9;">${p.titular}</small><br>
                        ${btnBula}
                    </td>
                    <td>
                        <strong>${p.ingrediente}</strong><br>
                        <small>${p.formulacao}</small><br>
                        ${acao}
                    </td>
                    <td>${p.classe}<br>${tox} ${amb}</td>
                    <td><div class="scroll-list">${culturas}</div></td>
                    <td><div class="scroll-list">${pragas}</div></td>
                </tr>
            `;
            tbody.innerHTML += tr;
        });
    }
</script>

</body>
</html>
